<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="salt-api" attributes="node port cmd target func userid password authtype">
    <template>
        <iron-ajax
            id="saltapi"
            url="http://{{node}}:{{port}}/{{cmd}}/"
            content-type="application/json"
            method="{{method}}"
            body='{"client":"local", "tgt":"{{target}}", "fun":"{{func}}", "username":"{{userid}}", "password":"{{password}}", "eauth":"{{authtype}}"}'
            handle-as="json"
            on-response="handle200"
            on-error="handleErr">
        </iron-ajax>
    </template>
</dom-module>

<script>
    Polymer({
        is: 'salt-api',

        properties: {
            method: {
                type: String,
                value: ""
            }
        },

        runGet: function() {
            this.method = "GET";
            this.$.saltapi.generateRequest();
        },

        runPost: function() {
            this.method = "POST";
            this.$.saltapi.generateRequest();
        },

        handle200: function(e) {
            console.log("salt-api:handle200(): firing 'salt-api-response' event.");
            this.fire("salt-api-response");
        },

        handleErr: function(e) {
            console.log("salt-api:handleErr(): firing 'salt-api-error' event");
            this.fire("salt-api-error");
        },
    });
</script>
